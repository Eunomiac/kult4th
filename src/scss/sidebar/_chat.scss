// .element {
// 	@include cq-prolyfill("width >= 100px") {
// 		/* Styles for .element if its container is at least 100px wide */
// 	}
// }

& {
  min-height: 100%;
  position: relative;
  top: -32px;
  overflow: visible;
  padding: 0;

  #chat-log {

    @include set-default-theme();

    --color-text-dark-primary: var(--color-body-text);
    --chat-vert-padding: 10px;
    --chat-horiz-padding: 10px;

    .chat-message {
      width: var(--sidebar-width);
      margin: 44px 0 44px calc(var(--sidebar-horiz-gutter) - var(--scrollbar-width));
      padding: 0;
      position: relative;
      background: transparent;

      &:last-child {
        margin-bottom: 20px;
      }

      .message-header {
        opacity: 0;
        transition: 0.25s;
        position: absolute;
        padding: 0 5px;
        height: 20px;
        top: 0px;
        left: -2px;
        border: 2px outset var(--K4-dGOLD);
        border-bottom: none;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        background: linear-gradient(var(--K4-dGOLD), var(--K4-dGOLD) 22px, transparent 24px);
        width: var(--sidebar-width);
        z-index: 3;

        &:hover {
          opacity: 1;
          top: -24px;
          height: 56px;
        }
      }

      .message-content {
        padding: var(--chat-vert-padding) 5px;
        width: var(--sidebar-width);
        min-height: 42px;

        .message-bg {
          position: absolute;
          height: 100%;
          width: 100%;
          border: 1px solid transparent;
          border-image: var(--K4-chat-border-image) 58 8/58px 8px/22px 0px 22px 0px stretch;
          border-image-slice: 58 8 fill;
          top: 0;
          left: 0;
          z-index: 0;
        }

        .kult4th-chat {
          position: relative;
          z-index: 2;
          font-size: $rem-14;
          line-height: $rem-18;
          padding: 0 var(--chat-horiz-padding) 15px var(--chat-horiz-padding);

          ul,
          ul.rules-list,
          ul.inline-list {
            --K4-list-indent: 15px;
          }

          .sheet-header {
            .header-filler {
              display: none;
            }

            .item-title {
              font-size: $rem-18;
              height: $rem-24;
              line-height: $rem-20;
              color: var(--K4-color-contrast);
              font-family: var(--font-primary-caps);
              font-weight: $font-weight-bold;
              background: linear-gradient(to right,
                var(--K4-color-contrast),
                var(--K4-color-primary-bright) 30px,
                var(--K4-color-primary-bright) calc(100% - 30px),
                var(--K4-color-contrast));
              text-shadow: -1px -1px 0px var(--K4-color-primary-bright), 1px 1px 0px var(--K4-color-primary);
              text-transform: uppercase;
              text-align: center;
              margin-top: calc(-1 * var(--chat-vert-padding));
              margin-left: calc(-1 * var(--chat-horiz-padding));
              width: calc(100% + 2 * var(--chat-horiz-padding) + var(--scrollbar-width));
              padding: 3px 0 0;
            }
          }

          .edges-header,
          .hold-header {
            background: none;
            font-weight: $font-weight-semi;
            transform: translate(-12.5%, 0) scaleX(1.25);
            transform-origin: center center;
          }
          @import 'roll-result';
        }

      }

    }
  }

  #chat-controls {
    opacity: 0;
    margin-top: -14px;
    margin-bottom: -22px;
    pointer-events: none;
    transition: 0.5s;
    z-index: 3;
    min-height: 32px;
    width: fit-content;
    padding-left: 20px;
    padding-right: 20px;
    border-radius: 30px;
    align-self: flex-end;
    background: linear-gradient(to left, var(--K4-dBLACK) 100%, transparent);
    background-clip: none;

    .chat-control-icon,
    .roll-type-select {
      display: none;
    }

    .control-buttons {
      display: flex;
      flex-wrap: nowrap;
      flex-direction: row;
      gap: 15px;
    }

  }

  #chat-form {
    --sidebar-chat-form-height: 150px;
    --sidebar-chat-form-margin: 3px;
    --sidebar-chat-form-padding: 5px;
    flex: 0 0 var(--sidebar-chat-form-height);
    padding: var(--sidebar-chat-form-margin);
    margin-bottom: 0;
    display: flex;
    position: relative;
    top: 10px;
    border: 4px double var(--K4-dGOLD);
    margin-top: -6px;
    width: var(--sidebar-width);
    margin-left: var(--sidebar-horiz-gutter);
    left: calc(-1 * var(--sidebar-chat-form-padding));
    background: var(--K4-BLACK);


    &::before {
      content: "";
      display: block;
      height: auto;
      width: auto;
      position: absolute;
      top: 3px;
      left: 3px;
      bottom: 3px;
      right: 3px;
      background: transparent #{to-url("backgrounds/bg-black-leather.webp")} repeat center/500px 500px;
      opacity: 1;
      transition: opacity 0.5s ease-in-out;
      z-index: 2;
    }

    &::after {
      content: "";
      display: block;
      height: auto;
      width: auto;
      position: absolute;
      top: 3px;
      left: 3px;
      bottom: 3px;
      right: 3px;
      background: transparent #{to-url("animations/chat-input-bg.webp")} repeat center/500px 500px;
      filter: grayscale(100%) sepia(100%) brightness(0.25) blur(5px);
      z-index: 1;
    }

    &:focus-within {
      border-color: var(--K4-bGOLD);
      &::before {
        opacity: 0;
      }
      #chat-message {
        box-shadow: inset 0 0 15px 5px var(--K4-dBLACK), inset 0 0 5px 150px rgba(0, 0, 0, 0.25);
      }
      #chat-input-controls {
        &::before {
          visibility: visible;
        }

        button {
          left: calc((-1 * var(--button-width)) - 5px);
          opacity: 0.75;
        }
      }
    }

    #chat-message {
      background: transparent;
      border-color: var(--K4-GOLD);
      font-family: var(--font-primary);
      margin: 0;
      height: auto;
      width: auto;
      position: absolute;
      z-index: 2;
      top: 3px;
      left: 3px;
      bottom: 3px;
      right: 3px;
    }

    #chat-input-controls {
      --button-width: 30px;
      --button-active-width: 40px;

      position: absolute;
      height: 100%;
      width: 30px;
      display: flex;
      flex-direction: column;
      left: 0px;
      transition: 0.5s;
      opacity: 1;

      button {
        transform-origin: center center;
        position: relative;
        transition: 0.5s;
        left: 0;
        opacity: 0;
        box-shadow: none !important;
        filter: brightness(0.5);

        i { scale: 1.5; }

        .button-label {
          position: absolute;
          white-space: nowrap;
          top: 0px;
          right: calc((-1 * var(--button-width)) - 5px);
          opacity: 0;
          font-family: 'KultrataSC';
          text-transform: lowercase;
          transition: 0.5s;
        }

        &:hover {
          opacity: 1;
          filter: brightness(1);
          width: calc(var(--button-width) + 5px);
          left: calc(-1 * var(--button-width) - 10px);

          .button-label {
            right: calc(var(--button-width) + 15px);
            opacity: 1;
          }
        }
      }

      &::before {
        width: calc(var(--sidebar-width) - 2*var(--sidebar-chat-form-padding));
        position: absolute;
        z-index: 4;
        text-align: center;
        bottom: 3px;
        font-size: 12px;
        font-family: var(--font-primary-smallcaps);
        visibility: hidden;
        font-weight: $font-weight-black;
      }
    }

    &[data-type='ic'] {
      #chat-input-controls::before {
        content: "( in-character )"
      }

      #ic { filter: grayscale(1) brightness(1.5); }
    }
    &[data-type='ooc'] {
      #chat-input-controls::before {
        content: "( out-of-character )";
        color: var(--K4-BLACK);
      }

      #ooc { filter: grayscale(1) brightness(1.5); }
      border-color: var(--K4-BLUE);
      &::after {
        opacity: 1;
        filter: grayscale(100%) blur(5px) invert(1);
      }
      #chat-message {
        color: var(--K4-BLACK);
        text-shadow: none;
        font-weight: 500;
        box-shadow: none !important;
      }
    }
    &[data-type='gm'] {
      #chat-input-controls::before {
        content: "( private message to gamemaster )";
        color: var(--K4-WHITE);
      }
      #gm { filter: grayscale(1) brightness(1.5); }
      border-color: var(--K4-GREY);
      &::after {
        filter: grayscale(100%) brightness(1) blur(5px);
      }
      #chat-message {
        font-style: italic;
        font-weight: 500;
        color: var(--K4-WHITE);
      }
    }
  }
}
